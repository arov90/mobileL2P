@using L2PAPIClient.DataModel;
@using Grp.L2PSite.MobileApp.Helpers;
@{
    ViewData["Title"] = "My Courses";
    List<L2PCourseInfoData> semestersList = new List<L2PCourseInfoData>();
    String semCode = null;
    if (ViewData["semesters"] != null)
    {
        semestersList = (List<L2PCourseInfoData>)ViewData["semesters"];
    }
    var semesters = (from a in semestersList
                     select new { code = a.semester, name = Tools.formatSemesterCode(a.semester) }).Distinct();
    if(ViewData["chosenSemesterCode"] != null)
    {
        semCode = ViewData["chosenSemesterCode"].ToString();
    }
}

<div class="container">
    <div class="row">
        <div class="col s12">
            <br />
            @if (semesters != null && semesters.Any())
            {
                if(semCode == null)
                {
                    semCode = semesters.First().code;
                }
                <div class="input-field col s12">
                    <select>
                        <option value="" disabled>Semester Select</option>
                        @foreach (var sem in semesters.ToList())
                        {
                            if (sem.code.Equals(semCode))
                            {
                                <option value="@semCode" selected>@Tools.formatSemesterCode(semCode)</option>
                            }
                            else
                            {
                                <option value="@sem.code">@sem.name</option>
                            }
                        }
                    </select>
                    <label>Choose your semester</label>
                </div>

                        <ul class="collection with-header">
                            <li class="collection-header center-align"><h4>@ViewData["Title"]</h4></li>
                            @{
                                List<L2PCourseInfoData> currentCourses = L2PAPIClient.api.Calls.L2PviewAllCourseIfoBySemesterAsync(semCode).Result.dataset;
                                foreach (L2PCourseInfoData course in currentCourses)
                                {
                                    <li class="collection-item avatar">
                                        <i class="material-icons circle">school</i>
                                        <span class="title"><a asp-controller="MyCourse" asp-action="ShowSubject" asp-route-id="@course.uniqueid">@course.courseTitle</a></span>
                                        <p>
                                            @course.courseStatus <br>
                                            @course.description
                                        </p>
                                        <a id="a-secondary-content" class="secondary-content" asp-controller="MyCourse" asp-action="ShowSubject" asp-route-id="@course.uniqueid"><i class="material-icons">send</i></a>
                                    </li>
                                }
                            }
                        </ul>
                                }
            }
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('select').material_select();
    });

    $("select").change(function () {

        window.location = "?id=" + $(this).val();
    });

</script>
